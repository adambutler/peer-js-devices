(function(){var n,t,e=function(n,t){return function(){return n.apply(t,arguments)}};n=function(){function n(n,t,o){this.device=n,this.connection=t,this.autoreconnect=null!=o?o:!0,this.connectionOpen=e(this.connectionOpen,this),this.connectionClose=e(this.connectionClose,this),this.connectionError=e(this.connectionError,this),this.connectionData=e(this.connectionData,this),null!=this.connection&&this.setupEvents(),this.autoreconnect=null==this.connection}return n.prototype.connectionLive=!1,n.prototype.events={},n.prototype.timeout=2e3,n.prototype.debug=!0,n.prototype.on=function(n,t){return null==this.events[n]&&(this.events[n]=[]),this.events[n].push(t)},n.prototype.callEvent=function(n,t){var e,o,i,c,r;if(null==t&&(t={}),null!=this.events[n]){for(c=this.events[n],r=[],o=0,i=c.length;i>o;o++)e=c[o],r.push(e(t));return r}},n.prototype.setupEvents=function(){return this.debug&&console.log("DeviceConnection - setupEvents"),this.connection.on("error",this.connectionError),this.connection.on("close",this.connectionClose),this.connection.on("open",this.connectionOpen),this.connection.on("data",this.connectionData)},n.prototype.closeConnection=function(n){return null==n&&(n=!1),null!=n&&(this.autoreconnect=n),this.connection.close(),this.callEvent("connectionClose")},n.prototype.connectionData=function(n){return"ping"===n&&setTimeout(function(n){return function(){return n.connection.send("pong")}}(this),1e3),"pong"===n&&setTimeout(function(n){return function(){return n.connection.send("ping")}}(this),1e3),console.log("Got data",n),this.callEvent("connectionData",n)},n.prototype.connectionError=function(n){return this.connectionLive=!1,this.autoreconnect&&this.connect(),this.debug&&console.log("An error ooccurred",n),this.callEvent("connectionClose",n)},n.prototype.connectionClose=function(){return this.connectionLive=!1,this.autoreconnect&&this.connect(),console.log("Connection closed"),this.callEvent("connectionClose")},n.prototype.connectionOpen=function(){return this.connectionLive=!0,null!=this.timer&&clearTimeout(this.timer),this.debug&&console.log("Connection open"),this.callEvent("connectionOpen")},n.prototype.setupTimeout=function(){return this.timer=setTimeout(function(n){return function(){return n.connectionLive?void 0:n.connect()}}(this),this.timeout)},n.prototype.dial=function(n){return this.remoteID=n,console.log("Client "+this.device.id+" connecting to peer - "+this.remoteID),this.connection=this.device.peer.connect(this.remoteID),this.setupEvents(),this.autoreconnect?this.setupTimeout():void 0},n.prototype.send=function(n){return console.log("Sending data",n),this.connection.send(n)},n}(),t="undefined"!=typeof exports&&null!==exports?exports:this,t.DeviceConnection=n}).call(this),function(){var n,t;n=function(){function n(n,t,e){this.id=n,this.host=null!=t?t:"127.0.0.1",this.port=null!=e?e:9e3,null==this.id&&(this.id=null),this.peer=new Peer(this.id,{host:this.host,port:this.port}),this.setupEvents()}return n.prototype.deviceConnections=[],n.prototype.setupEvents=function(){return this.peer.on("connection",function(n){return function(t){var e;return e=new DeviceConnection(n,t),n.deviceConnections.push(e)}}(this))},n.prototype.createDeviceConnection=function(){var n;return n=new DeviceConnection(this),this.deviceConnections.push(n),n},n}(),t="undefined"!=typeof exports&&null!==exports?exports:this,t.Device=n}.call(this),function(){var n,t,e={}.hasOwnProperty,o=function(n,t){function o(){this.constructor=n}for(var i in t)e.call(t,i)&&(n[i]=t[i]);return o.prototype=t.prototype,n.prototype=new o,n.__super__=t.prototype,n};n=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return o(t,n),t.prototype.ping=function(n,t,e){return null==n&&(n="ping"),null==t&&(t=5e3),null==e&&(e=!1),this.pingQueue=e,this.pingTimer=setInterval(function(t){return function(){var e,o,i,c;if(!(t.pingQueue===!1||t.pingQueue>0))return clearTimeout(t.pingTimer);for(console.log("Sending payload - "+n),c=t.deviceConnections,o=0,i=c.length;i>o;o++)e=c[o],e.connection.send(n);return t.pingQueue!==!1?t.pingQueue=t.pingQueue-1:void 0}}(this),t)},t}(Device),t="undefined"!=typeof exports&&null!==exports?exports:this,t.Client=n}.call(this),function(){var n,t,e={}.hasOwnProperty,o=function(n,t){function o(){this.constructor=n}for(var i in t)e.call(t,i)&&(n[i]=t[i]);return o.prototype=t.prototype,n.prototype=new o,n.__super__=t.prototype,n};n=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return o(t,n),t.prototype.ping=function(){return console.log("Pong said the presenter")},t}(Device),t="undefined"!=typeof exports&&null!==exports?exports:this,t.Presenter=n}.call(this);